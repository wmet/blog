---
title: git中遇到的一些问题
date: 2017-07-25 01:52:44
tags:
  - git
  - 技术
categories:
  - 技术
  - Git
keywords:
  - git
description: git
---

### git单机多用户设置
有时候不同的项目需要用不同的账户，可以这样配置：
1. 新建user2的SSH Key
   新建SSH key：
```
$ cd ~/.ssh     # 切换到C:\Users\Administrator\.ssh
ssh-keygen -t rsa -C "mywork@email.com"  # 新建工作的SSH key
#设置名称为id_rsa_work
 Enter file in which to save the key (/c/Users/Administrator/.ssh/id_rsa): id_rsa_work
```
2. 新密钥添加到SSH agent中
```
ssh-agent bash
ssh-add ~/.ssh/id_rsa_work
```
3. 修改config文件
   在~/.ssh目录下找到config文件，如果没有就创建：
   touch config        # 创建config
   然后修改如下：
```
# 该文件用于配置私钥对应的服务器
# Default github user(first@mail.com)
Host github.com
 HostName github.com
 User git
 IdentityFile C:/Users/Administrator/.ssh/id_rsa

 # second user(second@mail.com)
 # 建一个github别名，新建的帐号使用这个别名做克隆和更新
Host github2
 HostName github.com
 User git
 IdentityFile C:/Users/Administrator/.ssh/id_rsa_work
```
5. 打开新生成的~/.ssh/id_rsa2.pub文件，将里面的内容添加到GitHub后台。
6. 不同项目remote设置
    不同的项目配置不同url
```
[remote "origin"]
	url = github2:username/myreps.git
	fetch = +refs/heads/*:refs/remotes/origin/*
```
### Git强制更新本地仓库
```
git fetch --all  
git reset --hard origin/master 
#git reset --hard head
git pull
```

### 强覆盖用本地代码替代git仓库内容
  git push -f（可解决Non-fast-forward）

### Git一次推送多个服务器
编辑本地仓库的.git/config文件即可达到目的。
[remote "all"]
    url = git@github.com:luoshupeng/commonuseppa.git
    url = git@gitcafe.com:chinesedragon/commonuseppa.git
    url = chinesedragon@gitcd.com:/commonuseppa
这样，使用git push all即可一键Push到多个远程仓库中。

### git 删除本地分支和远程分支
【git 删除本地分支】
git branch -D br
【git 删除远程分支】
git push origin :br  (origin 后面有空格)
git push -f

### git放弃对当前文件夹的所有文件的修改？
git checkout .

### 撤销尚未提交的修改
git checkout head . （尚未git add ）

### 本地代码回滚和远程代码库回滚
git代码库回滚: 指的是将代码库某分支退回到以前的某个commit id
【本地代码库回滚】：
git reset --hard commit-id :回滚到commit-id，讲commit-id之后提交的commit都去除 （已经add commit的 ）
git reset --hard HEAD~3：将最近3次的提交回滚
【远程代码库回滚】：
这个是重点要说的内容，过程比本地回滚要复杂
应用场景：自动部署系统发布后发现问题，需要回滚到某一个commit，再重新发布
原理：先将本地分支退回到某个commit，删除远程分支，再重新push本地分支
操作步骤：
1、git checkout the_branch
2、git pull
3、git branch the_branch_backup //备份一下这个分支当前的情况
4、git reset --hard the_commit_id //把the_branch本地回滚到the_commit_id
5、git push origin :the_branch //删除远程 the_branch
6、git push origin the_branch //用回滚后的本地分支重新建立远程分支
7、git push origin :the_branch_backup //如果前面都成功了，删除这个备份分支
